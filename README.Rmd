---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cardid

<!-- badges: start -->
<!-- badges: end -->

The goal of cardid is to allow you to use the information of basketball and 
    baseball sports trading cards in order to find the (1) player and (2) year
    that each card refers to. In addition, it allows the creation of a card 
    identifier.

## Installation

You can install the released version of cardid from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("cardid")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("jk2049/cardid")
```
## Example

Below you can find an example of the functionalities offered. Please keep in 
mind that this is an early version. As a result, the results of this code have 
only been tested when running the functions in the same order as in the below 
example:

```{r example}
library(cardid)
library(dplyr)
library(stringr)
library(data.table)
library(plyr)
```

The package offers three datasets. The first is a dataset with information
about all the player who have played in the MLB:

```{r dataset1}
head(baseball.players)
```

The second is a dataset with information about all the player who have 
played in the NBA:
```{r dataset2}
head(basketball.players)
```

The third is a subset of a dataset that contains information about sports 
trading cards that were listed on eBay:
```{r dataset3}
head(dt.example)

dt.example.titles <- dt.example[, list(sports, card_title)]
dt.example.basketball.titles <- dt.example.titles[sports == "Basketball", ]
dt.example.baseball.titles <- dt.example.titles[sports == "Baseball", ]
dt.example.years <- dt.example[, list(sports, card_title, product_section_year)]
```

### Card Title Pre-Processing

First, we use the function ''data.preprocess'' on the card title columns in 
order to manipulate the card titles (i.e., remove stopwords etc.)

```{r cardtitlepreprocessing}
dt.example.basketball.titles$card_title <- data.preprocess(dt.example.basketball.titles$card_title)
dt.example.baseball.titles$card_title <- data.preprocess(dt.example.baseball.titles$card_title)
dt.example.years$card_title_2 <- data.preprocess(dt.example.years$card_title)
```

### Get Card Player

Then, we use the function ''get.player'' to find the player(s) that each card
title refers to. 

```{r getplayer}
dt.example.basketball.titles <- rbindlist(apply(dt.example.basketball.titles, 1, get.player,
                                                card.title.col.name = "card_title", sport = "basketball"), fill=TRUE)
dt.example.baseball.titles <- rbindlist(apply(dt.example.baseball.titles, 1, get.player,
                                              card.title.col.name = "card_title", sport = "baseball"), fill=TRUE)
```

### Get Product ID

The next step is to identify the year that each card refers to. We can identify
the card year with at most two ways: One is by analyzing the card title through
the function ''get.year.from.title'', while the other is to analyze the 
information contained in the product section field of the listed cards through 
the function ''get.year.from.product.section''. The product section field may 
or may not have been filled in by the seller. 

Once we are done, we use ''get.product.year'' to construct the card year column.

```{r getyear}
# Year from the card title
dt.example.years <- suppressWarnings(rbindlist(apply(dt.example.years, 1, get.year.from.title,
                                                     card.title.col.name = "card_title"), fill=TRUE))

# Year from the product section information
dt.example.years <- rbindlist(apply(dt.example.years, 1, get.year.from.product.section,
                                    product.section.year.col.name = "product_section_year"), fill=TRUE)

# Combine the two
dt.example.years <- get.product.year(dt.example.years)
```

### Get Valid Product ID

Although we have constructed a product identifier, there are still some
pending issues that can only be discovered upon closer inspection of the data:
<ol>
<li> For some entries the previous functions have identified identical player
names that have been inserted in separate columns. By using 
''remove.duplicate.players'' we can remove the duplicates and only keeps
the unique names</li>
<li> There's an issue with some names that contain "jr.". This issue is only 
present for the baseball cards. We address this issue using ''fix.names''. </li>
<li> In some cases the identified player names can refer to players who were 
active during different periods in time (e.g., Bob Smith for baseball). We 
address this issue by using ''player.tie.break''. This function utilizes the 
identified card year and pinpoints which specific player each card refers to. </li>
<li> We have constructed a product id for any cards for which we have identified
at least one player and a year. The product id however should only be valid 
for those cards for which exactly one player has been identified. The function
''flag.id.valid'' flags these observations. </li>
</ol>


```{r getvalidproductid}
dt.example.5.1.1 <- remove.duplicate.players(dt.example, "basketball")
dt.example.5.1.2 <- remove.duplicate.players(dt.example, "baseball")

dt.example.5.2.2 <- fix.names(dt.example.5.1.2, "baseball")

dt.example.5.3.1 <- player.tie.break(dt.example.5.1.1, "basketball")
dt.example.5.3.2 <- player.tie.break(dt.example.5.2.2, "baseball")

dt.example.5 <- rbind.fill(dt.example.5.3.1, dt.example.5.3.2)
dt.example.5 <- as.data.table(dt.example.5)

dt.example.valid <- flag.id.valid(dt.example.5)
```

### Drop Columns

Using the function ''drop.useless.columns'' we can drop some columns that are
no longer needed. 

```{r dropcolumns}
colnames(dt.example.valid)
dt.example.valid <- drop.useless.columns(dt.example.valid)
colnames(dt.example.valid)
```

### Get Additional Player Information

Our initial sports player datasets contain information that we have not 
included. Using the function ''add.player.info'' we add this information to our
dataset.

```{r getadditionalinfo}
dt.example.valid.hof <- add.player.info(dt.example.valid)
head(dt.example.valid.hof)
```
