---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cardid

<!-- badges: start -->
<!-- badges: end -->

The goal of cardid is to allow you to use the information of basketball and 
    baseball sports trading cards in order to find the (1) player and (2) year
    that each card refers to. In addition, it allows the creation of a card 
    identifier.

## Installation

You can install the released version of cardid from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("cardid")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("jk2049/cardid")
```
## Example

Below you can find an example of the functionalities offered. Please keep in 
mind that this is an early version. As a result, the results of this code have 
only been tested when running the functions in the same order as in the below 
example:

```{r example}
library(cardid)
library(dplyr)
library(stringr)
library(data.table)
library(plyr)
```

The package offers three datasets. The first is a dataset with information
about all the player who have played in the MLB:

```{r dataset1}
head(dt.baseball.players)
```

The second is a dataset with information about all the player who have 
played in the NBA:
```{r dataset2}
head(dt.basketball.players)
```

The third is a subset of a dataset that contains information about sports 
trading cards that were listed on eBay:
```{r dataset3}
head(dt.example)

dt.example.titles <- dt.example[, list(sports, card_title)]
dt.example.basketball.titles <- dt.example.titles[sports == "Basketball", ]
dt.example.baseball.titles <- dt.example.titles[sports == "Baseball", ]
dt.example.years <- dt.example[, list(sports, card_title, product_section_year)]
```

### Player Name Pre-Processing

First, we use the functions ''baseball.preprocess'' and ''baseball.preprocess''
in order to manipulate the player names of the MLB and the NBA players 
respectively. Standard NLP actions are taken (i.e., remove stopwords etc.) that
allow us to build a dictionary of player names. This is important as the same 
player names (e.g., shaquille o'neal) can be written in different ways in the
card titles (e.g., shaquille o'neal, shaquille o neal, shaquille oneal etc.).

```{r playernamepreprocessing}
baseball.players <- baseball.preprocess(dt.baseball.players)
basketball.players <- basketball.preprocess(dt.basketball.players)
```

### Card Title Pre-Processing

Second, we use the function ''data.preprocess'' on the card title columns in 
order to manipulate the card titles (i.e., remove stopwords etc.)

```{r cardtitlepreprocessing}
dt.example.basketball.titles$card_title <- data.preprocess(dt.example.basketball.titles$card_title)
dt.example.baseball.titles$card_title <- data.preprocess(dt.example.baseball.titles$card_title)
dt.example.years$card_title_2 <- data.preprocess(dt.example.years$card_title)
```

### Get Card Player

Then, we use the function ''get.player'' to find the player(s) that each card
title refers to. 

```{r getplayer}
get.player <- function(dt.input, card.title.col.name = "card_title", sport){

  card.title.index <- which(names(dt.input) == card.title.col.name)

  if(sport == "basketball"){
    head(basketball.players)

    players.in.title <- basketball.players[str_detect(dt.input[card.title.index], basketball.players$player),
                                           "original_player"]
  }else if(sport == "baseball"){
    players.in.title <- baseball.players[str_detect(dt.input[card.title.index], baseball.players$player),
                                         "original_player"]
  }else{
    stop(paste("Sport ", sport, " is not supported."))
  }
  n.players <- length(players.in.title)
  players.in.title <- paste(players.in.title, sep = ",")

  if(length(players.in.title) == 0) players.in.title <- NA

  dt.output <- c(dt.input, "n_players" = n.players,
                 players.in.title)
  dt.output <- as.data.frame(t(dt.output))

  return(dt.output)
}


dt.example.basketball.titles <- rbindlist(apply(dt.example.basketball.titles, 1, get.player,
                                                card.title.col.name = "card_title", sport = "basketball"), fill=TRUE)
dt.example.baseball.titles <- rbindlist(apply(dt.example.baseball.titles, 1, get.player,
                                              card.title.col.name = "card_title", sport = "baseball"), fill=TRUE)
```

